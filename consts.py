

# State at revision VE.Direct-Protocol-3.33.pdf

ALARM_REASON = {'1': 'Low Voltage',
 '1024': 'Low V AC out',
 '128': 'Mid Voltage',
 '16': 'High Starter Voltage',
 '2': 'High Voltage',
 '2048': 'High V AC out',
 '256': 'Overload',
 '32': 'Low Temperature',
 '4': 'Low SOC',
 '4096': 'Short Circuit',
 '512': 'DC-ripple',
 '64': 'High Temperature',
 '8': 'Low Starter Voltage',
 '8192': 'BMS Lockout'}

OFF_REASON = {'0x00000001': 'No input power',
 '0x00000002': 'Switched off (power switch)',
 '0x00000004': 'Switched off (device mode register)',
 '0x00000008': 'Remote input',
 '0x00000010': 'Protection active',
 '0x00000020': 'Paygo',
 '0x00000040': 'BMS',
 '0x00000080': 'Engine shutdown detection',
 '0x00000100': 'Analysing input voltage'}

BLUETOOH_OFF_REASON = {'0x00000001': 'BLE supports switching off',
 '0x00000002': 'BLE switching off is permanent'}

STATE_OF_OPERATION = {'0': 'Off',
 '1': 'Low power',
 '2': 'Fault',
 '3': 'Bulk',
 '4': 'Absorption',
 '5': 'Float',
 '6': 'Storage',
 '7': 'Equalize (manual)',
 '9': 'Inverting',
 '11': 'Power supply',
 '245': 'Starting-up',
 '246': 'Repeated absorption',
 '247': 'Auto equalize / Recondition',
 '248': 'BatterySafe',
 '252': 'External Control'}

DEVICE_ERROR = {'0': 'No error',
 '116': 'Factory calibration data lost',
 '117': 'Invalid/incompatible firmware',
 '119': 'User settings invalid',
 '17': 'Charger temperature too high',
 '18': 'Charger over current',
 '19': 'Charger current reversed',
 '2': 'Battery voltage too high',
 '20': 'Bulk time limit exceeded',
 '21': 'Current sensor issue (sensor bias/sensor broken)',
 '26': 'Terminals overheated',
 '28': 'Converter issue (dual converter models only)',
 '33': 'Input voltage too high (solar panel)',
 '34': 'Input current too high (solar panel)',
 '38': 'Input shutdown (due to excessive battery voltage)',
 '39': 'Input shutdown (due to current flow during off mode)',
 '65': 'Lost communication with one of devices',
 '66': 'Synchronised charging device configuration issue',
 '67': 'BMS connection lost',
 '68': 'Network misconfigured'}

DEVICE_MODE = {'1': 'VE_REG_MODE_CHARGER',
 '2': 'VE_REG_MODE_INVERTER',
 '253': 'VE_REG_MODE_HIBERNATE',
 '4': 'VE_REG_MODE_OFF',
 '5': 'VE_REG_MODE_ECO'}

MPPT_OPERATION = {'0': 'Off', '1': 'Voltage or current limited', '2': 'MPP Tracker active'}

DC_MONITOR_MODE = {'-1': 'Generic source',
 '-2': 'AC charger',
 '-3': 'DC/DC charger',
 '-4': 'Water generator',
 '-5': 'Fuel cell',
 '-6': 'Alternator',
 '-7': 'Shaft generator',
 '-8': 'Wind turbine',
 '-9': 'Solar charger',
 '0': 'Battery monitor (BMV)',
 '1': 'Generic load',
 '2': 'Electric drive',
 '3': 'Fridge',
 '4': 'Water pump',
 '5': 'Bilge pump',
 '6': 'DC system',
 '7': 'Inverter',
 '8': 'Water heater'}

PRODUCT_TYPES = {'0x0300': 'BlueSolar MPPT 70|15',
 '0x203': 'BMV-700',
 '0x204': 'BMV-702',
 '0x205': 'BMV-700H',
 '0xA040': 'BlueSolar MPPT 75|50',
 '0xA041': 'BlueSolar MPPT 150|35',
 '0xA042': 'BlueSolar MPPT 75|15',
 '0xA043': 'BlueSolar MPPT 100|15',
 '0xA044': 'BlueSolar MPPT 100|30',
 '0xA045': 'BlueSolar MPPT 100|50',
 '0xA046': 'BlueSolar MPPT 150|70',
 '0xA047': 'BlueSolar MPPT 150|100',
 '0xA049': 'BlueSolar MPPT 100|50 rev2',
 '0xA04A': 'BlueSolar MPPT 100|30 rev2',
 '0xA04B': 'BlueSolar MPPT 150|35 rev2',
 '0xA04C': 'BlueSolar MPPT 75|10',
 '0xA04D': 'BlueSolar MPPT 150|45',
 '0xA04E': 'BlueSolar MPPT 150|60',
 '0xA04F': 'BlueSolar MPPT 150|85',
 '0xA050': 'SmartSolar MPPT 250|100',
 '0xA051': 'SmartSolar MPPT 150|100',
 '0xA052': 'SmartSolar MPPT 150|85',
 '0xA053': 'SmartSolar MPPT 75|15',
 '0xA054': 'SmartSolar MPPT 75|10',
 '0xA055': 'SmartSolar MPPT 100|15',
 '0xA056': 'SmartSolar MPPT 100|30',
 '0xA057': 'SmartSolar MPPT 100|50',
 '0xA058': 'SmartSolar MPPT 150|35',
 '0xA059': 'SmartSolar MPPT 150|100 rev2',
 '0xA05A': 'SmartSolar MPPT 150|85 rev2',
 '0xA05B': 'SmartSolar MPPT 250|70',
 '0xA05C': 'SmartSolar MPPT 250|85',
 '0xA05D': 'SmartSolar MPPT 250|60',
 '0xA05E': 'SmartSolar MPPT 250|45',
 '0xA05F': 'SmartSolar MPPT 100|20',
 '0xA060': 'SmartSolar MPPT 100|20 48V',
 '0xA061': 'SmartSolar MPPT 150|45',
 '0xA062': 'SmartSolar MPPT 150|60',
 '0xA063': 'SmartSolar MPPT 150|70',
 '0xA064': 'SmartSolar MPPT 250|85 rev2',
 '0xA065': 'SmartSolar MPPT 250|100 rev2',
 '0xA066': 'BlueSolar MPPT 100|20',
 '0xA067': 'BlueSolar MPPT 100|20 48V',
 '0xA068': 'SmartSolar MPPT 250|60 rev2',
 '0xA069': 'SmartSolar MPPT 250|70 rev2',
 '0xA06A': 'SmartSolar MPPT 150|45 rev2',
 '0xA06B': 'SmartSolar MPPT 150|60 rev2',
 '0xA06C': 'SmartSolar MPPT 150|70 rev2',
 '0xA06D': 'SmartSolar MPPT 150|85 rev3',
 '0xA06E': 'SmartSolar MPPT 150|100 rev3',
 '0xA06F': 'BlueSolar MPPT 150|45 rev2',
 '0xA070': 'BlueSolar MPPT 150|60 rev2',
 '0xA071': 'BlueSolar MPPT 150|70 rev2',
 '0xA072': 'BlueSolar MPPT 150/45 rev3',
 '0xA073': 'SmartSolar MPPT 150/45 rev3',
 '0xA074': 'SmartSolar MPPT 75/10 rev2',
 '0xA075': 'SmartSolar MPPT 75/15 rev2',
 '0xA076': 'BlueSolar MPPT 100/30 rev3',
 '0xA077': 'BlueSolar MPPT 100/50 rev3',
 '0xA078': 'BlueSolar MPPT 150/35 rev3',
 '0xA079': 'BlueSolar MPPT 75/10 rev2',
 '0xA07A': 'BlueSolar MPPT 75/15 rev2',
 '0xA07B': 'BlueSolar MPPT 100/15 rev2',
 '0xA07C': 'BlueSolar MPPT 75/10 rev3',
 '0xA07D': 'BlueSolar MPPT 75/15 rev3',
 '0xA07E': 'SmartSolar MPPT 100/30 12V',
 '0xA07F': 'All-In-1 SmartSolar MPPT 75/15 12V',
 '0xA102': 'SmartSolar MPPT VE.Can 150/70',
 '0xA103': 'SmartSolar MPPT VE.Can 150/45',
 '0xA104': 'SmartSolar MPPT VE.Can 150/60',
 '0xA105': 'SmartSolar MPPT VE.Can 150/85',
 '0xA106': 'SmartSolar MPPT VE.Can 150/100',
 '0xA107': 'SmartSolar MPPT VE.Can 250/45',
 '0xA108': 'SmartSolar MPPT VE.Can 250/60',
 '0xA109': 'SmartSolar MPPT VE.Can 250/70',
 '0xA10A': 'SmartSolar MPPT VE.Can 250/85',
 '0xA10B': 'SmartSolar MPPT VE.Can 250/100',
 '0xA10C': 'SmartSolar MPPT VE.Can 150/70 rev2',
 '0xA10D': 'SmartSolar MPPT VE.Can 150/85 rev2',
 '0xA10E': 'SmartSolar MPPT VE.Can 150/100 rev2',
 '0xA10F': 'BlueSolar MPPT VE.Can 150/100',
 '0xA112': 'BlueSolar MPPT VE.Can 250/70',
 '0xA113': 'BlueSolar MPPT VE.Can 250/100',
 '0xA114': 'SmartSolar MPPT VE.Can 250/70 rev2',
 '0xA115': 'SmartSolar MPPT VE.Can 250/100 rev2',
 '0xA116': 'SmartSolar MPPT VE.Can 250/85 rev2',
 '0xA117': 'BlueSolar MPPT VE.Can 150/100 rev2',
 '0xA201': 'Phoenix Inverter 12V 250VA 230V',
 '0xA202': 'Phoenix Inverter 24V 250VA 230V',
 '0xA204': 'Phoenix Inverter 48V 250VA 230V',
 '0xA211': 'Phoenix Inverter 12V 375VA 230V',
 '0xA212': 'Phoenix Inverter 24V 375VA 230V',
 '0xA214': 'Phoenix Inverter 48V 375VA 230V',
 '0xA221': 'Phoenix Inverter 12V 500VA 230V',
 '0xA222': 'Phoenix Inverter 24V 500VA 230V',
 '0xA224': 'Phoenix Inverter 48V 500VA 230V',
 '0xA231': 'Phoenix Inverter 12V 250VA 230V',
 '0xA232': 'Phoenix Inverter 24V 250VA 230V',
 '0xA234': 'Phoenix Inverter 48V 250VA 230V',
 '0xA239': 'Phoenix Inverter 12V 250VA 120V',
 '0xA23A': 'Phoenix Inverter 24V 250VA 120V',
 '0xA23C': 'Phoenix Inverter 48V 250VA 120V',
 '0xA241': 'Phoenix Inverter 12V 375VA 230V',
 '0xA242': 'Phoenix Inverter 24V 375VA 230V',
 '0xA244': 'Phoenix Inverter 48V 375VA 230V',
 '0xA249': 'Phoenix Inverter 12V 375VA 120V',
 '0xA24A': 'Phoenix Inverter 24V 375VA 120V',
 '0xA24C': 'Phoenix Inverter 48V 375VA 120V',
 '0xA251': 'Phoenix Inverter 12V 500VA 230V',
 '0xA252': 'Phoenix Inverter 24V 500VA 230V',
 '0xA254': 'Phoenix Inverter 48V 500VA 230V',
 '0xA259': 'Phoenix Inverter 12V 500VA 120V',
 '0xA25A': 'Phoenix Inverter 24V 500VA 120V',
 '0xA25C': 'Phoenix Inverter 48V 500VA 120V',
 '0xA261': 'Phoenix Inverter 12V 800VA 230V',
 '0xA262': 'Phoenix Inverter 24V 800VA 230V',
 '0xA264': 'Phoenix Inverter 48V 800VA 230V',
 '0xA269': 'Phoenix Inverter 12V 800VA 120V',
 '0xA26A': 'Phoenix Inverter 24V 800VA 120V',
 '0xA26C': 'Phoenix Inverter 48V 800VA 120V',
 '0xA271': 'Phoenix Inverter 12V 1200VA 230V',
 '0xA272': 'Phoenix Inverter 24V 1200VA 230V',
 '0xA274': 'Phoenix Inverter 48V 1200VA 230V',
 '0xA279': 'Phoenix Inverter 12V 1200VA 120V',
 '0xA27A': 'Phoenix Inverter 24V 1200VA 120V',
 '0xA27C': 'Phoenix Inverter 48V 1200VA 120V',
 '0xA281': 'Phoenix Inverter 12V 1600VA 230V',
 '0xA282': 'Phoenix Inverter 24V 1600VA 230V',
 '0xA284': 'Phoenix Inverter 48V 1600VA 230V',
 '0xA291': 'Phoenix Inverter 12V 2000VA 230V',
 '0xA292': 'Phoenix Inverter 24V 2000VA 230V',
 '0xA294': 'Phoenix Inverter 48V 2000VA 230V',
 '0xA2A1': 'Phoenix Inverter 12V 3000VA 230V',
 '0xA2A2': 'Phoenix Inverter 24V 3000VA 230V',
 '0xA2A4': 'Phoenix Inverter 48V 3000VA 230V',
 '0xA340': 'Phoenix Smart IP43 Charger 12|50 (1+1)',
 '0xA341': 'Phoenix Smart IP43 Charger 12|50 (3)',
 '0xA342': 'Phoenix Smart IP43 Charger 24|25 (1+1)',
 '0xA343': 'Phoenix Smart IP43 Charger 24|25 (3)',
 '0xA344': 'Phoenix Smart IP43 Charger 12|30 (1+1)',
 '0xA345': 'Phoenix Smart IP43 Charger 12|30 (3)',
 '0xA346': 'Phoenix Smart IP43 Charger 24|16 (1+1)',
 '0xA347': 'Phoenix Smart IP43 Charger 24|16 (3)',
 '0xA381': 'BMV-712 Smart',
 '0xA382': 'BMV-710H Smart',
 '0xA383': 'BMV-712 Smart Rev2',
 '0xA389': 'SmartShunt 500A/50mV',
 '0xA38A': 'SmartShunt 1000A/50mV',
 '0xA38B': 'SmartShunt 2000A/50mV',
 '0xA3F0': 'Smart BuckBoost 12V/12V-50A'}

LABEL_VALUE_MAPPING = {
 "AR": ALARM_REASON,
 "OR": OFF_REASON,
 "CAP_BLE": BLUETOOH_OFF_REASON,
 "PID": PRODUCT_TYPES,
 "MON": DC_MONITOR_MODE,
 "MPPT": MPPT_OPERATION,
 "MODE": DEVICE_MODE,
 "ERR": DEVICE_ERROR,
 "CS": STATE_OF_OPERATION
}

LABEL_DEFINITIONS = {
            'PID': {"description": 'Product ID', "data_type": str, "value_mapping": PRODUCT_TYPES},
            'FW': {"description": 'Firmware version', "data_type": str},
            'SER#': {"description": 'Serial number', "data_type": str},
            "V": {"description": "Main or channel 1 (battery) voltage", "unit": "mV"},
            "V2": {"description": "Channel 2 (battery) voltage", "unit": "mV"},
            "V3": {"description": "Channel 3 (battery) voltage", "unit": "mV"},
            "VS": {"description": "Auxiliary (starter) voltage", "unit": "mV"},
            "VM": {"description": "Mid-point voltage of the battery bank", "unit": "mV"},
            "VPV": {"description": "Panel voltage", "unit": "mV"},
            "DM": {"description": "Mid-point deviation of the battery bank", "unit": "‰"},
            "PPV": {"description": "Panel power", "unit": "W"},
            "I": {"description": "Main or channel 1 (battery) current", "unit": "mA"},
            "I2": {"description": "Channel 2 (battery) current", "unit": "mA"},
            "I3": {"description": "Channel 3 (battery) current", "unit": "mA"},
            "IL": {"description": "Load current", "unit": "mA"},
            "LOAD": {"description": "Load output state"},
            "T": {"description": "Battery temperature", "unit": "°C"},
            "P": {"description": "Instantaneous power", "unit": "W"},
            "CE": {"description": "Consumed Amp Hours", "unit": "mAh"},
            "SOC": {"description": "State-of-charge", "unit": "‰"},
            "TTG": {"description": "Time-to-go", "unit": "mAh"},
            "Alarm": {"description": "Alarm condition active"},
            "Relay": {"description": "Relay state"},
            "AR": {"description": "Alarm reason", "value_mapping": ALARM_REASON},
            "OR": {"description": "Off reason", "value_mapping": OFF_REASON},
            'H1': {"description": 'Consumed Amp Hours', 'Unit': 'mAh'},
            'H2': {"description": 'Depth of the last discharge ', "data_type": int, 'Unit': 'mAh'},
            'H3': {"description": 'Depth of the average discharge', "data_type": int, 'Unit': 'mAh'},
            'H4': {"description": 'Number of charge cycles', "data_type": int},
            'H5': {"description": 'Number of full discharges', "data_type": int},
            'H6': {"description": 'Cumulative Amp Hours drawn', "data_type": int, 'Unit': 'mAh'},
            'H7': {"description": 'Minimum main (battery) voltage', "data_type": int, 'Unit': 'mV'},
            'H8': {"description": 'Maximum main (battery) voltage', "data_type": int, 'Unit': 'mV'},
            'H9': {"description": 'Number of seconds since last full charge', "data_type": int, 'Length': 4, 'Unit': 's'},
            'H10': {"description": 'Number of automatic synchronizations ', "data_type": int},
            'H11': {"description": 'Number of low main voltage alarms ', "data_type": int},
            'H12': {"description": 'Number of high main voltage alarms', "data_type": int},
            'H13': {"description": 'Number of low auxiliary voltage alarms', "data_type": int},
            'H14': {"description": 'Number of high auxiliary voltage alarms', "data_type": int},
            'H15': {"description": 'Minimum auxiliary (battery) voltage', "data_type": int, 'Unit': 'mV'},
            'H16': {"description": 'Maximum auxiliary (battery) voltage', "data_type": int, 'Unit': 'mV'},
            'H17': {"description": 'Amount of discharged energy (BMV) / Amount of produced energy (DC monitor)',
                    "data_type": int, 'unit': "0.01 kWh"},
            'H18': {"description": 'Amount of charged energy (BMV) / Amount of consumed energy (DC monitor)',
                    "data_type": int, 'unit': "0.01 kWh"},
            'H19': {"description": 'Yield total', "data_type": int, 'unit': "0.01 kWh"},
            'H20': {"description": 'Yield today', "data_type": int, 'unit': "0.01 kWh"},
            "H21": {"description": "Maximum power today", "unit": "W"},
            'H22': {"description": 'Yield yesterday', "data_type": int, 'unit': "0.01 kWh"},
            "H23": {"description": "Maximum power yesterday ", "unit": "W"},
            'ERR': {"description": 'Error code', "data_type": str, "value_mapping": DEVICE_ERROR},
            'CS': {"description": 'Charger status', "data_type": int, "value_mapping": STATE_OF_OPERATION},
            'BMW': {"description": 'Model description', "data_type": str},
            'FWE': {"description": 'Firmware version', "data_type": str},
            'HSDS': {"description": 'State number for historical logging', "data_type": int},
            'MODE': {"description": 'Device mode', "data_type": int, "value_mapping": DEVICE_MODE},
            'AC_OUT_V': {"description": 'AC output voltage', "data_type": int, 'Unit': '0.01 V'},
            'AC_OUT_I': {"description": 'AC output current', "data_type": int, 'Unit': '0.01 A'},
            'AC_OUT_S': {"description": 'AC output apparent power', "data_type": int, 'Unit': 'VA'},
            'WARN': {"description": 'Warning reason', "data_type": int},
            'MPPT': {"description": 'Tracker operation mode', "data_type": int, "value_mapping": MPPT_OPERATION},
            'MON': {"description": 'Tracker operation mode', "data_type": int, "value_mapping": DC_MONITOR_MODE},
            'DC_IN_V': {"description": 'DC input voltage', "data_type": int, 'Unit': '0.01 V'},
            'DC_IN_I': {"description": 'DC input current', "data_type": int, 'Unit': '0.01 A'},
            'DC_IN_S': {"description": 'DC input apparent power', "data_type": int, 'Unit': 'VA'}
        }